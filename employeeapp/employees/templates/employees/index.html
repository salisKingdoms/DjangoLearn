<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Manage Employees</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>
<body class="container py-4">

    <h2 class="mb-3">Employee Management</h2>

    <!-- Form -->
    <form id="employeeForm">
        {% csrf_token %}
        <input type="hidden" id="empId">
        <div class="mb-2">
            <input type="text" id="name" class="form-control" placeholder="Name" required>
        </div>
        <div class="mb-2">
            <input type="email" id="email" class="form-control" placeholder="Email" required>
        </div>
        <div class="mb-2">
            <input type="text" id="department" class="form-control" placeholder="Department" required>
        </div>
        <div class="mb-2">
            <input type="number" step="0.01" id="salary" class="form-control" placeholder="Salary" required>
        </div>
        <button type="submit" class="btn btn-primary">Save</button>
    </form>

    <hr>

    <!-- Table -->
    <table class="table table-bordered mt-3">
        <thead>
            <tr>
                <th>ID</th><th>Name</th><th>Email</th><th>Department</th><th>Salary</th><th>Actions</th>
            </tr>
        </thead>
        <tbody id="employeeTable"></tbody>
    </table>

    <script>
        function loadEmployees() {
            $.get('/employees/list/', function(res) {
                let rows = '';
                res.data.forEach(emp => {
                    rows += `
                        <tr>
                            <td>${emp.id}</td>
                            <td>${emp.name}</td>
                            <td>${emp.email}</td>
                            <td>${emp.department}</td>
                            <td>${emp.salary}</td>
                            <td>
                                <button class="btn btn-sm btn-warning" onclick="editEmployee(${emp.id}, '${emp.name}', '${emp.email}', '${emp.department}', '${emp.salary}')">Edit</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteEmployee(${emp.id})">Delete</button>
                            </td>
                        </tr>`;
                });
                $('#employeeTable').html(rows);
            });
        }

        $('#employeeForm').submit(function(e) {
            e.preventDefault();
            let id = $('#empId').val();
            let data = {
                name: $('#name').val(),
                email: $('#email').val(),
                department: $('#department').val(),
                salary: $('#salary').val()
            };

            if (id) {
                $.ajax({
                    url: `/employees/update/${id}/`,
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(data),
                    success: function() {
                        loadEmployees();
                        $('#employeeForm')[0].reset();
                        $('#empId').val('');
                    }
                });
            } else {
                $.ajax({
                    url: '/employees/create/',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(data),
                    success: function() {
                        loadEmployees();
                        $('#employeeForm')[0].reset();
                    }
                });
            }
        });

        function editEmployee(id, name, email, department, salary) {
            $('#empId').val(id);
            $('#name').val(name);
            $('#email').val(email);
            $('#department').val(department);
            $('#salary').val(salary);
        }

        function deleteEmployee(id) {
            $.ajax({
                url: `/employees/delete/${id}/`,
                type: 'POST',
                success: function() {
                    loadEmployees();
                }
            });
        }

        $(document).ready(function() {
            loadEmployees();
        });
    </script>

<script>
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    const csrftoken = getCookie('csrftoken');

    $.ajaxSetup({
        headers: { "X-CSRFToken": csrftoken }
    });
</script>

</body>
</html>
